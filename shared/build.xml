<?xml version="1.0"?>

<project name="vaadin-shared" basedir="." default="publish-local"
    xmlns:ivy="antlib:org.apache.ivy.ant">
    <description>
        The shared module containing classes used by both server and client.
    </description>
    <include file="../common.xml" as="common" />
    <include file="../build.xml" as="vaadin" />
    <include file="../gwt-files.xml" as="gwtfiles" />

    <!-- global properties -->
    <property name="module.name" value="vaadin-shared" />
    <property name="module.symbolic" value="com.vaadin.shared" />
    <property name="result.dir" location="result" />
    <property name="src.filtered" location="${result.dir}/filtered-src" />
    <property name="src" location="${src.filtered}" />
    <path id="classpath.compile.custom">
        <fileset file="${gwt.elemental.jar}" />
    </path>
    <path id="classpath.test.custom" />

    <target name="jar">
        <property name="shared.osgi.import"
            value="com.google.gwt.thirdparty.streamhtmlparser;version=&quot;0.0.10.vaadin1&quot;, com.google.gwt.thirdparty.streamhtmlparser.impl;version=&quot;0.0.10.vaadin1&quot;, com.google.gwt.thirdparty.streamhtmlparser.util;version=&quot;0.0.10.vaadin1&quot;, org.w3c.flute.parser;version=&quot;1.3.0.gg2&quot;, org.w3c.flute.parser.selectors;version=&quot;1.3.0.gg2&quot;, org.w3c.flute.util;version=&quot;1.3.0.gg2&quot;" />
        <property name="shared.osgi.require-bundle"
            value="com.google.gwt.thirdparty.guava;bundle-version=&quot;16.0.1.vaadin1&quot;" />
        <delete dir="${src.filtered}" />
        <!-- Update version in Version.java -->
        <copy todir="${src.filtered}">
            <fileset dir="src">
            </fileset>
            <filterchain>
                <replacetokens begintoken="@" endtoken="@">
                    <token key="VERSION" value="${vaadin.version}" />
                </replacetokens>
            </filterchain>
        </copy>

        <antcall target="common.jar">
            <param name="import-package" value="${shared.osgi.import}" />
            <param name="require-bundle" value="${shared.osgi.require-bundle}" />
            <reference refid="shared.gwt.includes" torefid="extra.jar.includes" />
            <param name="osgi.extra.package.prefixes" value="elemental" />
        </antcall>
    </target>

    <target name="publish-local" depends="jar">
        <antcall target="common.sources.jar">
            <reference torefid="extra.jar.includes" refid="shared.gwt.includes" />
        </antcall>
        <antcall target="common.javadoc.jar" />

        <antcall target="common.publish-local" />
    </target>

    <target name="clean">
        <antcall target="common.clean" />
    </target>

    <target name="checkstyle">
        <antcall target="common.checkstyle">
            <param name="cs.src" location="src" />
        </antcall>
    </target>

    <target name="test" depends="checkstyle">
        <antcall target="common.test.run" />
    </target>

</project>
