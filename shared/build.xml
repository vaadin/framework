<?xml version="1.0"?>

<project name="vaadin-shared" basedir="." default="publish-local" xmlns:ivy="antlib:org.apache.ivy.ant">
	<description>
		Compiles build helpers used when building other modules.
	</description>
	<include file="../common.xml" as="common" />
	<include file="../build.xml" as="vaadin" />
	<include file="../gwt-files.xml" as="gwtfiles" />

	<!-- global properties -->
	<property name="module.name" value="vaadin-shared" />
	<property name="module.symbolic" value="com.vaadin.shared" />
	<property name="result.dir" value="result" />
	<property name="src.filtered" value="${result.dir}/filtered-src" />
	<path id="classpath.compile.custom" />


	<target name="jar">
		<property name="shared.osgi.import" value="org.json;version=&quot;20080701&quot;, com.google.gwt.thirdparty.guava.common.annotations, com.google.gwt.thirdparty.guava.common.base, com.google.gwt.thirdparty.guava.common.base.internal, com.google.gwt.thirdparty.guava.common.cache, com.google.gwt.thirdparty.guava.common.collect, com.google.gwt.thirdparty.guava.common.eventbus, com.google.gwt.thirdparty.guava.common.io, com.google.gwt.thirdparty.guava.common.net, com.google.gwt.thirdparty.guava.common.primitives, com.google.gwt.thirdparty.guava.common.util.concurrent, com.google.gwt.thirdparty.streamhtmlparser, com.google.gwt.thirdparty.streamhtmlparser.impl, com.google.gwt.thirdparty.streamhtmlparser.util, org.w3c.flute.parser, org.w3c.flute.parser.selectors, org.w3c.flute.util" />
		<delete dir="${src.filtered}" />
		<!-- Update version in Version.java -->
		<copy todir="${src.filtered}">
			<fileset dir="src">

			</fileset>
			<!-- file="src/com/vaadin/shared/Version.java" todir="${result.dir}/filtered-src/com/vaadin/shared">-->
			<filterchain>
				<replacetokens begintoken="@" endtoken="@">
					<token key="VERSION" value="${vaadin.version}" />
				</replacetokens>
			</filterchain>
		</copy>

		<antcall target="common.jar">
			<param name="src" value="${filtered.src}" />
			<param name="import-package" value="${shared.osgi.import}" />
			<reference refid="shared.gwt.includes" torefid="extra.jar.includes" />
		</antcall>
	</target>

	<target name="publish-local" depends="jar">
		<antcall target="common.sources.jar" />
		<antcall target="common.javadoc.jar" />

		<antcall target="common.publish-local" />
	</target>

	<target name="clean">
		<antcall target="common.clean" />
	</target>

	<target name="tests">
		<!--<antcall target="common.tests.run" />-->
		<echo>WHAT? No tests for ${module.name}!</echo>
	</target>

</project>